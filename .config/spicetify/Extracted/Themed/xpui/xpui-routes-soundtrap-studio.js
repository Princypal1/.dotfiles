"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[3780],{83504:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var s=r(59496),n=r(84875),o=r.n(n),c=r(90641),i=r(92053),a=r(58908),u=r(80326),l=r(54009),p=r(27293),d=r(20225),f=r(44050),w=r(35708);var h=r(40192),I=r(58964),g=r(64384),m=r(81186);const j="_8NXEiIW8UUvsBVNhHdc",k="pZytOOt4d5hSOwPD8A_V";var y=r(4637);const b=(0,s.memo)((()=>{const e=(0,d.n)(),{projectId:t,songId:r}=(0,i.UO)(),n=(0,s.useRef)(null),b=(0,c.I0)(),v=(0,w.z)(),E=(0,i.s0)(),S=(0,s.useMemo)((()=>[["showtippopups",0],["workflow","cover"],["workflowSongId",r]].map((([e,t])=>`${e}=${t}`)).join("&")),[r]),U=(0,c.v9)((e=>e.session.user?.uri)),P=(0,a.EC)(U).toURLPath(!0),[$,C]=(0,s.useState)(null),{route:O,error:x}=(({redirectUri:e})=>{const t=(0,w.z)(),[r,n]=(0,s.useState)(""),[o,c]=(0,s.useState)(null);return(0,s.useEffect)((()=>{(async()=>{try{const{token:r}=await t.requestAccountLinkToken();n(`https://www.soundtrap.com/spotify/accountlink/?redirect=${encodeURIComponent(e)}&token=${r}`)}catch(e){c("Something went wrong while trying link your account")}})()}),[t,e]),{route:r,error:o}})({redirectUri:`https://www.soundtrap.com/studio/${t}/?${S}`}),{resetMainView:L,collapseMainView:_}=(0,f.i)(),M=(0,I.g)(),V=(0,g.Y)((e=>e?.hasContext&&!e?.isPaused));(0,s.useEffect)((()=>{const e=n.current;return v.setIframe(e),()=>{v.setIframe(null)}}),[n,v,b]),(0,m.I)(h.O.EXIT,(()=>{E(-1)})),(0,m.I)(h.O.PUBLISH,(async({data:e})=>{const t=!e.title||!e.projectId;if(C(null),t)C("Cannot publish project, title or projectId are missing.");else try{await v.publish({projectId:e.projectId,title:e.title,isPrivate:!0===e.isPrivate}),E(P,{replace:!0,state:{referrer:"soundtrap_publish",newProjectId:e.projectId}})}catch(e){C("Something went wrong while trying to publish the project.")}})),(0,s.useEffect)((()=>{V&&M?.pause()}),[V,M]),(0,s.useEffect)((()=>(_(),L)),[]);const z=x??$;return z?(0,y.jsx)(p.h,{hasError:!0,errorMessage:z}):(0,y.jsxs)(s.Suspense,{fallback:null,children:[(0,y.jsx)(l.$,{children:u.ag.get("playlist.page-title")}),(0,y.jsx)("iframe",{ref:n,src:O,className:o()(j,{[k]:e}),allow:"microphone https://www.soundtrap.com/studio;",title:"Soundtrap"})]})}))},81186:(e,t,r)=>{r.d(t,{I:()=>o});var s=r(59496),n=r(35708);function o(e,t){const r=(0,n.z)();(0,s.useEffect)((()=>{const s=r.getEvents(),n=e=>t(e);return s.addListener(e,n),()=>{s.removeListener(e,n)}}),[e,r,t])}}}]);
//# sourceMappingURL=xpui-routes-soundtrap-studio.js.map